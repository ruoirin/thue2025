<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sơ đồ tương tác Luật Thuế & Hóa Đơn 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease-in-out;
            overflow: hidden;
        }
        .card-header {
            padding: 1.25rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb;
        }
        .card-header:hover {
            background-color: #f9fafb;
        }
        .card-title {
            font-weight: 600;
            color: #1e3a8a;
        }
        .card-content {
            padding: 0 1.25rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding-top 0.5s ease-in-out, padding-bottom 0.5s ease-in-out;
        }
        .card-content.open {
            max-height: 1000px;
            padding-top: 1.25rem;
            padding-bottom: 1.25rem;
        }
        .date-badge {
            background-color: #e0f2fe;
            color: #0c4a6e;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .icon {
            margin-right: 0.75rem;
            color: #3b82f6;
        }
        .conclusion-card {
            background-color: #e0f2fe;
            border-left: 4px solid #3b82f6;
        }
        .main-title {
            color: #1e3a8a;
            font-size: 2.25rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1rem;
        }
        .subtitle {
            color: #374151;
            font-size: 1.125rem;
            text-align: center;
            margin-bottom: 2.5rem;
        }
        .section-title {
            color: #1e40af;
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #93c5fd;
        }
        .arrow-icon {
            transition: transform 0.3s ease-in-out;
        }
        .arrow-icon.rotate {
            transform: rotate(180deg);
        }
        ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }
        li {
            margin-bottom: 0.5rem;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        /* Chatbot Styles */
        #chatbot-toggle-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #1e3a8a;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        #chatbot-container {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 350px;
            max-width: 90vw;
            height: 500px;
            max-height: 70vh;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            display: none; /* Hidden by default */
            flex-direction: column;
            overflow: hidden;
            z-index: 999;
        }
        #chatbot-container.open {
            display: flex;
        }
        #chatbot-header {
            background-color: #1e3a8a;
            color: white;
            padding: 1rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #close-chatbot-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        #chatbot-messages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem; /* 12px */
        }
        .chat-message {
            padding: 0.5rem 0.75rem; /* 8px 12px */
            border-radius: 8px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #e0f2fe; /* Light sky blue */
            color: #0c4a6e; /* Dark sky blue */
            align-self: flex-end;
            margin-left: 20%;
        }
        .bot-message {
            background-color: #f3f4f6; /* Light gray */
            color: #1f2937; /* Dark gray */
            align-self: flex-start;
            margin-right: 20%;
        }
        #chatbot-input-container {
            display: flex;
            padding: 0.75rem; /* 12px */
            border-top: 1px solid #e5e7eb;
        }
        #chatbot-input {
            flex-grow: 1;
            border: 1px solid #d1d5db; /* Gray border */
            padding: 0.5rem 0.75rem; /* 8px 12px */
            border-radius: 6px;
            margin-right: 0.5rem; /* 8px */
        }
        #chatbot-send-btn {
            background-color: #2563eb; /* Blue */
            color: white;
            padding: 0.5rem 1rem; /* 8px 16px */
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        #chatbot-send-btn:hover {
            background-color: #1d4ed8; /* Darker blue */
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="container mx-auto max-w-6xl">
        <h1 class="main-title">Cập Nhật Luật Thuế & Hóa Đơn 2025</h1>
        <p class="subtitle">Sơ đồ tương tác các thay đổi quan trọng có hiệu lực từ năm 2025</p>

        <div class="grid md:grid-cols-2 gap-8 mb-12">
            <section>
                <h2 class="section-title">
                    <i class="fas fa-landmark icon"></i>Luật Thuế GTGT 2025 (Luật số 48/2024)
                </h2>
                <div class="space-y-4">
                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-credit-card icon"></i>Điều kiện khấu trừ thuế GTGT đầu vào</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/7/2025</p>
                            <p>Bắt buộc phải sử dụng chứng từ thanh toán không dùng tiền mặt đối với mọi hàng hóa, dịch vụ đầu vào để được khấu trừ thuế GTGT. Quy định này chặt chẽ hơn nhiều so với trước đây. Cần chờ thông tư hướng dẫn chi tiết cho các trường hợp đặc thù.</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-edit icon"></i>Kê khai bổ sung thuế đầu vào sai sót</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/7/2025</p>
                            <ul>
                                <li>Nếu sai sót làm tăng số thuế phải nộp hoặc giảm số thuế được hoàn: phải kê khai bổ sung trong tháng/quý phát sinh sai sót.</li>
                                <li>Nếu sai sót chỉ làm thay đổi số thuế khấu trừ được chuyển kỳ sau: kê khai tại kỳ phát hiện sai sót.</li>
                                <li>Đối với hóa đơn bị bỏ sót: quy định mới cho phép kê khai luôn vào kỳ phát hiện sai sót thay vì phải bổ sung về kỳ gốc phát sinh như trước đây.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-undo-alt icon"></i>Bổ sung trường hợp được hoàn thuế GTGT</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/7/2025</p>
                            <p>Hỗ trợ doanh nghiệp sản xuất, kinh doanh hàng hóa chịu thuế suất 5%. Nếu thuế GTGT đầu vào còn được khấu trừ trên 300 triệu đồng sau 12 tháng (hoặc 4 quý), doanh nghiệp này sẽ được hoàn thuế. Quy định cũ không có điều khoản này.</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-link icon"></i>Điều kiện hoàn thuế (ràng buộc người bán)</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/7/2025</p>
                            <p>Để được hoàn thuế, bên mua phải đảm bảo rằng bên bán đã kê khai và nộp đủ thuế trên hóa đơn GTGT đó. Quy định cũ không yêu cầu bên mua phải quan tâm đến việc kê khai của bên bán. Điều này có thể gây khó khăn cho bên mua.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section>
                <h2 class="section-title">
                    <i class="fas fa-file-invoice-dollar icon"></i>Nghị định 70/2025/NĐ-CP
                </h2>
                <div class="space-y-4">
                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-globe-asia icon"></i>Đối tượng áp dụng hóa đơn điện tử</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/6/2025</p>
                            <p>Bổ sung: Các nhà cung cấp nước ngoài không có cơ sở thường trú tại Việt Nam, hoạt động kinh doanh thương mại điện tử hoặc trên nền tảng số có thể đăng ký tự nguyện để áp dụng hóa đơn điện tử.</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-store icon"></i>Hộ kinh doanh (thay đổi)</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/6/2025</p>
                            <p>Hộ kinh doanh có doanh thu từ 1 tỷ đồng trở lên/năm (căn cứ doanh thu khoán năm trước hoặc cơ quan thuế xác định) sẽ không còn được áp dụng thuế khoán. Bắt buộc phải chuyển sang kê khai hoặc phải xuất hóa đơn. Điều này nhằm quản lý chặt chẽ doanh thu thực tế và yêu cầu hóa đơn đầu vào hợp lệ.</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-ban icon"></i>Bỏ quy định hủy hóa đơn sai</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/6/2025</p>
                            <p>Khái niệm hủy hóa đơn điện tử tại Nghị định 123 sẽ bị bãi bỏ. Thay vào đó, khi có sai sót, doanh nghiệp phải sử dụng hóa đơn điều chỉnh hoặc hóa đơn thay thế. Hóa đơn điều chỉnh/thay thế cần có sự thống nhất và ký số của cả bên mua và bên bán.</p>
                        </div>
                    </div>
                     <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-plane-departure icon"></i>Hóa đơn xuất khẩu (thời điểm lập)</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                             <p class="date-badge mb-2">Hiệu lực: 01/6/2025</p>
                            <p>Thời điểm lập hóa đơn xuất khẩu được nới lỏng hơn, chậm nhất không quá 1 ngày làm việc kể từ ngày hàng hóa được thông quan (trước đây là phải lập vào đúng ngày thông quan).</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-cash-register icon"></i>HĐĐT từ máy tính tiền (MTT)</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/6/2025</p>
                            <ul>
                                <li>Định nghĩa: Hóa đơn điện tử được lập tại thời điểm thu tiền, có kết nối dữ liệu với cơ quan thuế.</li>
                                <li>Yêu cầu bắt buộc sử dụng đối với một số ngành nghề bán lẻ hàng hóa hoặc cung cấp dịch vụ trực tiếp cho người tiêu dùng (nhà hàng, khách sạn).</li>
                                <li>Hộ kinh doanh khoán (doanh thu > 1 tỷ/năm, thuộc ngành nghề quy định) bắt buộc áp dụng từ 01/6/2025.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-info-circle icon"></i>Thông tin trên hóa đơn</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/6/2025</p>
                            <p>Cần thể hiện đầy đủ thông tin người mua (tên, địa chỉ, mã số thuế hoặc số định danh/căn cước công dân), trừ một số ngành đặc thù (bán xăng dầu). Đối với dịch vụ vận tải, hóa đơn phải ghi biển kiểm soát phương tiện, hành trình (điểm đi, điểm đến).</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-tags icon"></i>Hóa đơn chiết khấu, hàng trả lại</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/6/2025</p>
                            <p>Nghị định 70 có quy định cụ thể hơn về việc lập các loại hóa đơn này, giải quyết vấn đề khó khăn khi lập hóa đơn chiết khấu (ví dụ giá trị âm) theo quy định cũ.</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" onclick="toggleCard(this)">
                            <span class="card-title"><i class="fas fa-clock icon"></i>Thời điểm lập hóa đơn dịch vụ</span>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="card-content">
                            <p class="date-badge mb-2">Hiệu lực: 01/6/2025</p>
                            <ul>
                                <li>Đối với một số dịch vụ đặc thù (vận tải, viễn thông, quảng cáo, TMĐT, ngân hàng, phí đường bộ): được phép đối soát và lập hóa đơn trong phạm vi 7 ngày theo thỏa thuận, nhưng không quá ngày kê khai.</li>
                                <li>Đối với dầu thô/khí thiên nhiên: lập hóa đơn khi xác định tiêu thụ theo giá, nhưng không quá thời điểm kê khai.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <section class="mt-12">
            <h2 class="section-title"><i class="fas fa-balance-scale icon"></i>Kết Luận & Tác Động Chung</h2>
            <div class="card conclusion-card p-6">
                <p class="mb-4">Các thay đổi và cập nhật từ Luật Thuế GTGT 2025 và Nghị định 70/2025/NĐ-CP cho thấy sự siết chặt hơn trong công tác quản lý thuế, đặc biệt là nhằm minh bạch hóa doanh thu và quản lý chặt chẽ các giao dịch kinh tế.</p>
                <ul class="list-disc pl-5 space-y-2 text-gray-700">
                    <li><strong>Yêu cầu cao hơn:</strong> Bắt buộc thanh toán không dùng tiền mặt để khấu trừ thuế đầu vào và ràng buộc hoàn thuế với việc kê khai của người bán đòi hỏi sự cẩn trọng trong lựa chọn đối tác và quản lý dòng tiền.</li>
                    <li><strong>Tác động đến hộ kinh doanh:</strong> Việc chuyển đổi từ thuế khoán sang kê khai hoặc bắt buộc sử dụng HĐĐT từ MTT khi đạt ngưỡng doanh thu sẽ ảnh hưởng lớn, buộc họ phải quản lý doanh thu và chi phí chặt chẽ hơn.</li>
                    <li><strong>Tăng tính xác thực hóa đơn:</strong> Các quy định mới (bỏ hủy hóa đơn, yêu cầu cả hai bên ký hóa đơn điều chỉnh/thay thế, thông tin chi tiết) nâng cao khả năng kiểm soát của cơ quan thuế.</li>
                    <li><strong>Định hướng chung:</strong> Xây dựng môi trường kinh doanh minh bạch, công bằng, hạn chế tối đa việc trốn thuế, lách thuế.</li>
                </ul>
            </div>
        </section>
    </div>

    <div id="chatbot-toggle-btn">
        <i class="fas fa-comments"></i>
    </div>

    <div id="chatbot-container">
        <div id="chatbot-header">
            <span>Chatbot Thuế 2025</span>
            <button id="close-chatbot-btn"><i class="fas fa-times"></i></button>
        </div>
        <div id="chatbot-messages">
            <div class="chat-message bot-message">Xin chào! Tôi có thể giúp gì cho bạn về các thay đổi luật thuế và hóa đơn 2025? Hãy thử hỏi về "khấu trừ thuế", "hủy hóa đơn", hoặc "hộ kinh doanh".</div>
        </div>
        <div id="chatbot-input-container">
            <input type="text" id="chatbot-input" placeholder="Nhập câu hỏi của bạn...">
            <button id="chatbot-send-btn">Gửi</button>
        </div>
    </div>

    <script>
        function toggleCard(headerElement) {
            const content = headerElement.nextElementSibling;
            const arrow = headerElement.querySelector('.arrow-icon');
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                arrow.classList.remove('rotate');
            } else {
                content.classList.add('open');
                arrow.classList.add('rotate');
            }
        }

        // Chatbot Script
        const chatbotToggleBtn = document.getElementById('chatbot-toggle-btn');
        const chatbotContainer = document.getElementById('chatbot-container');
        const closeChatbotBtn = document.getElementById('close-chatbot-btn');
        const chatbotMessages = document.getElementById('chatbot-messages');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSendBtn = document.getElementById('chatbot-send-btn');

        const knowledgeBase = {
            "hello": "Xin chào! Tôi có thể giúp gì cho bạn về các thay đổi luật thuế và hóa đơn 2025?",
            "chào": "Xin chào! Tôi có thể giúp gì cho bạn về các thay đổi luật thuế và hóa đơn 2025?",
            "khấu trừ thuế": "Để được khấu trừ thuế GTGT đầu vào, bạn bắt buộc phải sử dụng chứng từ thanh toán không dùng tiền mặt cho mọi hàng hóa, dịch vụ. Quy định này có hiệu lực từ 01/7/2025.",
            "khấu trừ gtgts": "Để được khấu trừ thuế GTGT đầu vào, bạn bắt buộc phải sử dụng chứng từ thanh toán không dùng tiền mặt cho mọi hàng hóa, dịch vụ. Quy định này có hiệu lực từ 01/7/2025.",
            "thanh toán không dùng tiền mặt": "Việc thanh toán không dùng tiền mặt là bắt buộc để được khấu trừ thuế GTGT đầu vào, áp dụng từ 01/7/2025.",
            "kê khai bổ sung": "Nếu sai sót làm tăng thuế phải nộp/giảm thuế được hoàn, phải kê khai bổ sung trong tháng/quý phát sinh sai sót. Nếu chỉ thay đổi số thuế khấu trừ chuyển kỳ sau, kê khai tại kỳ phát hiện. Hóa đơn bỏ sót được kê khai vào kỳ phát hiện. (Luật Thuế GTGT 2025, hiệu lực 01/7/2025)",
            "hoàn thuế": "Doanh nghiệp sản xuất, kinh doanh hàng hóa chịu thuế suất 5% có thể được hoàn thuế nếu thuế GTGT đầu vào còn được khấu trừ trên 300 triệu đồng sau 12 tháng (hoặc 4 quý). Điều kiện hoàn thuế mới còn yêu cầu bên bán phải kê khai và nộp đủ thuế. (Luật Thuế GTGT 2025, hiệu lực 01/7/2025)",
            "điều kiện hoàn thuế": "Để được hoàn thuế GTGT, bên mua phải đảm bảo rằng bên bán đã kê khai và nộp đủ thuế trên hóa đơn GTGT đó. (Luật Thuế GTGT 2025, hiệu lực 01/7/2025)",
            "hủy hóa đơn": "Từ 01/6/2025, khái niệm hủy hóa đơn điện tử sẽ bị bãi bỏ. Khi có sai sót, doanh nghiệp phải sử dụng hóa đơn điều chỉnh hoặc hóa đơn thay thế, cần có sự thống nhất và ký số của cả hai bên. (Nghị định 70/2025/NĐ-CP)",
            "hóa đơn sai": "Nếu hóa đơn điện tử bị sai, từ 01/6/2025, bạn phải lập hóa đơn điều chỉnh hoặc hóa đơn thay thế, không còn hủy hóa đơn. Cần có ký số của cả bên mua và bán. (Nghị định 70/2025/NĐ-CP)",
            "hộ kinh doanh": "Hộ kinh doanh có doanh thu từ 1 tỷ đồng/năm trở lên sẽ không còn được áp dụng thuế khoán mà bắt buộc chuyển sang kê khai hoặc phải xuất hóa đơn. Áp dụng từ 01/6/2025. (Nghị định 70/2025/NĐ-CP)",
            "doanh thu 1 tỷ": "Hộ kinh doanh có doanh thu từ 1 tỷ đồng/năm (theo doanh thu khoán năm trước hoặc cơ quan thuế xác định) phải chuyển sang kê khai hoặc xuất hóa đơn từ 01/6/2025. (Nghị định 70/2025/NĐ-CP)",
            "máy tính tiền": "Một số ngành nghề bán lẻ, dịch vụ trực tiếp cho người tiêu dùng (nhà hàng, khách sạn) và hộ kinh doanh khoán (doanh thu > 1 tỷ/năm, thuộc ngành nghề quy định) bắt buộc sử dụng hóa đơn điện tử khởi tạo từ máy tính tiền có kết nối dữ liệu với cơ quan thuế từ 01/6/2025. (Nghị định 70/2025/NĐ-CP)",
            "hđđt từ mtt": "Hóa đơn điện tử từ máy tính tiền (HĐĐT từ MTT) là hóa đơn được lập tại thời điểm thu tiền, có kết nối dữ liệu với cơ quan thuế. Bắt buộc cho một số ngành nghề và hộ kinh doanh đủ điều kiện từ 01/6/2025. (Nghị định 70/2025/NĐ-CP)",
            "hóa đơn xuất khẩu": "Thời điểm lập hóa đơn xuất khẩu được nới lỏng, chậm nhất không quá 1 ngày làm việc kể từ ngày hàng hóa được thông quan. Trước đây là phải lập vào đúng ngày thông quan. (Nghị định 70/2025/NĐ-CP, hiệu lực 01/6/2025)",
            "thông tin trên hóa đơn": "Hóa đơn cần thể hiện đầy đủ thông tin người mua (tên, địa chỉ, MST hoặc số định danh/CCCD), trừ một số ngành đặc thù. Dịch vụ vận tải phải ghi biển kiểm soát, hành trình. (Nghị định 70/2025/NĐ-CP, hiệu lực 01/6/2025)",
            "chiết khấu": "Nghị định 70/2025/NĐ-CP (hiệu lực 01/6/2025) có quy định cụ thể hơn về việc lập hóa đơn cho hàng hóa chiết khấu, hàng trả lại, giải quyết các khó khăn trước đây.",
            "thời điểm lập hóa đơn dịch vụ": "Một số dịch vụ đặc thù (vận tải, viễn thông,...) được phép đối soát và lập hóa đơn trong 7 ngày theo thỏa thuận (không quá ngày kê khai). Dầu thô/khí thiên nhiên lập khi xác định tiêu thụ theo giá (không quá thời điểm kê khai). (Nghị định 70/2025/NĐ-CP, hiệu lực 01/6/2025)",
            "luật thuế gtgts": "Luật Thuế Giá trị gia tăng 2025 (Luật số 48/2024) có hiệu lực từ 01/7/2025, mang đến nhiều thay đổi quan trọng về khấu trừ và hoàn thuế GTGT.",
            "nghị định 70": "Nghị định 70/2025/NĐ-CP, có hiệu lực từ 01/6/2025, sửa đổi, bổ sung quy định về hóa đơn chứng từ, đặc biệt là hóa đơn điện tử.",
            "cảm ơn": "Rất vui khi được giúp bạn! Nếu có câu hỏi khác, đừng ngần ngại hỏi nhé.",
            "bye": "Tạm biệt! Chúc bạn một ngày tốt lành."
        };

        chatbotToggleBtn.addEventListener('click', () => {
            chatbotContainer.classList.toggle('open');
            if (chatbotContainer.classList.contains('open')) {
                chatbotToggleBtn.innerHTML = '<i class="fas fa-times"></i>'; // Change to close icon
            } else {
                chatbotToggleBtn.innerHTML = '<i class="fas fa-comments"></i>'; // Change back to chat icon
            }
        });

        closeChatbotBtn.addEventListener('click', () => {
            chatbotContainer.classList.remove('open');
            chatbotToggleBtn.innerHTML = '<i class="fas fa-comments"></i>'; // Ensure toggle button icon resets
        });

        chatbotSendBtn.addEventListener('click', handleUserInput);
        chatbotInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleUserInput();
            }
        });

        function handleUserInput() {
            const userInput = chatbotInput.value.trim().toLowerCase();
            if (userInput === "") return;

            addMessageToUI(chatbotInput.value, 'user'); // Display original case for user message
            chatbotInput.value = "";

            const botResponse = getBotResponse(userInput);
            setTimeout(() => { // Simulate bot thinking
                 addMessageToUI(botResponse, 'bot');
            }, 500);
        }

        function addMessageToUI(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', sender === 'user' ? 'user-message' : 'bot-message');
            messageDiv.textContent = text;
            chatbotMessages.appendChild(messageDiv);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight; // Scroll to the latest message
        }

        function getBotResponse(userInput) {
            userInput = userInput.toLowerCase(); // Ensure comparison is case-insensitive
            let bestMatch = null;
            let highestScore = 0;

            for (const keyword in knowledgeBase) {
                const keywords = keyword.split(" "); // Allow for multi-word keywords
                let currentScore = 0;
                keywords.forEach(kw => {
                    if (userInput.includes(kw)) {
                        currentScore++;
                    }
                });
                
                // Prioritize exact full phrase matches
                if (userInput === keyword) {
                    currentScore = keywords.length * 2; // Give higher weight to exact match
                }


                if (currentScore > highestScore) {
                    highestScore = currentScore;
                    bestMatch = knowledgeBase[keyword];
                }
            }
            
            if (bestMatch && highestScore > 0) return bestMatch;

            // More generic check if no strong keyword match
            if (userInput.includes("ngày hiệu lực") || userInput.includes("khi nào áp dụng")) {
                 if (userInput.includes("luật thuế gtgt")) return knowledgeBase["luật thuế gtgts"];
                 if (userInput.includes("nghị định 70")) return knowledgeBase["nghị định 70"];
                 return "Bạn muốn hỏi về ngày hiệu lực của văn bản nào cụ thể (Luật thuế GTGT hay Nghị định 70)?";
            }

            return "Xin lỗi, tôi chưa hiểu câu hỏi của bạn. Bạn có thể thử hỏi bằng các từ khóa như 'khấu trừ thuế', 'hủy hóa đơn', 'hộ kinh doanh', 'ngày hiệu lực luật thuế GTGT', 'ngày hiệu lực nghị định 70'.";
        }

    </script>
</body>
</html>
